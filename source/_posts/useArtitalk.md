---
title: artitalkçš„ä½¿ç”¨åŠç¾åŒ–
date: 2020-08-26 21:22:06
tags: [artitalk,website]
categories: ç½‘ç«™å»ºè®¾
photo: /img/banner/images/1.jpg
---

 Artitalkæ˜¯ä¸€æ¬¾é€šè¿‡leancloudå®ç°çš„å¯å®æ—¶å‘å¸ƒè¯´è¯´çš„jsã€‚å³é”®æˆ‘çš„åšå®¢ï¼Œç‚¹å‡»`æˆ‘çš„å°çª`ï¼Œçœ‹åˆ°çš„å³ä¸ºArtitalkç•Œé¢ã€‚

æœ¬æ–‡ä¸»è¦è®°å½•artitalkåœ¨pjaxç½‘ç«™çš„ä½¿ç”¨æ–¹æ³•åŠç¾åŒ–è¿‡ç¨‹ã€‚

<!--more -->

## åœ¨pjaxç½‘ç«™ä½¿ç”¨artitalk

å› ä¸ºartitalkå¹¶æ²¡æœ‰æä¾›é‡è½½å‡½æ•°ï¼Œå› æ­¤ç›®å‰çš„è§£å†³åŠæ³•ä¸»è¦æœ‰ä¸¤ç§ï¼š

1. åœ¨è¯¥é¡µé¢é€šè¿‡å„ç§æ‰‹æ®µè¿›è¡Œä¸€æ¬¡åˆ·æ–°ï¼Œä¾‹å¦‚ï¼š

   + å®˜æ–¹æ–‡æ¡£ä¸­çš„æ–¹æ³•ï¼Œè‡ªåŠ¨åœ¨artitalkç•Œé¢åˆ·æ–°

     ```javascript
     $(document).ready(function () {
         if(location.href.indexOf("#reloaded")==-1){
             location.href=location.href+"#reloaded";
             location.reload();
         }
     })
     ```

   + å¯¹äºvolantisä¸»é¢˜ï¼Œå°†artitalké¡µé¢çš„`window.location.pathname`åŠ å…¥åˆ°ä¸»é¢˜é…ç½®çš„pjaxé»‘åå•

2. æ‰‹åŠ¨æ¸…é™¤artitalkåˆå§‹åŒ–çš„`AV`å¯¹è±¡å¹¶é‡æ–°åŠ è½½jsæ–‡ä»¶

æ­¤å¤„æˆ‘ä»¬è®¨è®ºçš„æ˜¯ç¬¬äºŒç§æ–¹æ³•ï¼Œå®ç°èµ·æ¥å¾ˆç®€å•ï¼Œå‚ç…§[è¯¥pr](https://github.com/volantis-x/hexo-theme-volantis/pull/429/files)ï¼Œåªéœ€åœ¨è„šæœ¬å‰è¡¥ä¸Šä¸€è¡Œï¼š

```javascript
if (window.AV!= undefined){
    delete window.AV;
}
```

å¦‚æœä½ ä½¿ç”¨çš„æ˜¯é`valine`è¯„è®ºç³»ç»Ÿï¼Œåˆ°è¯¥æ­¥å·¥ä½œå·²ç»å®Œæˆã€‚

---

å¯¹äºvalineè¯„è®ºç³»ç»Ÿï¼Œæ ¹æ®inksså¤§ä½¬åœ¨[#368](https://github.com/volantis-x/hexo-theme-volantis/issues/368)ä¸‹çš„å›å¤ï¼š

> Artitalk å’Œ Valine ç­‰ï¼Œæˆ–è€…è¯´æ‰€æœ‰åŸºäº Leancloud æ’ä»¶ï¼Œå› ä¸º AV å¯¹è±¡æ˜¯ const å®šä¹‰ï¼Œä¸å…è®¸é‡å¤å®ä¾‹åŒ–ï¼Œæ‰€ä»¥ä»–ä»¬å…ˆå¤©æ€§å†²çªï¼Œè¿™ç‚¹æ˜¯æ— è§£çš„ï¼ˆé™¤éæ˜¯å…±ç”¨ AV å¯¹è±¡ï¼‰ã€‚

valineåŒæ ·ä¾èµ–`window.AV`æä¾›æœåŠ¡ä¸”åªåŠ è½½ä¸€æ¬¡ã€‚ä¸Šè¿°æ–¹æ³•è§£å†³artitalké—®é¢˜çš„ä»£ä»·æ˜¯ï¼š**åœ¨åŠ è½½artitalkç•Œé¢è¿‡ç¨‹ä¸­ï¼Œartitalkå°†valineçš„`window.AV`æ›¿æ¢æˆäº†è‡ªå·±çš„ã€‚**è¿™æ ·ä¼šå¯¼è‡´ä¸¤ä¸ªé—®é¢˜ï¼š

1. artitalké¡µé¢æ— æ³•ä½¿ç”¨valineï¼ˆå› ä¸ºåŠ è½½è¿‡ç¨‹ä¸­artitalkæŠŠvalineçš„`window.AV`åˆ æ‰äº†ï¼‰
2. è®¿é—®è¿‡artitalké¡µé¢åï¼Œvalineå¯ä»¥æ­£å¸¸ä½¿ç”¨ï¼Œä½†æ˜¯æ•°æ®æºä¼šè¢«æ›¿æ¢ä¸ºartitalkçš„ï¼ˆåŒç†ï¼Œå› ä¸ºvalineè‡ªå·±çš„`window.AV`è¢«æ›¿æ¢æ‰äº†ï¼‰

é—®é¢˜1åº”è¯¥å¯ä»¥é€šè¿‡è°ƒæ•´jsæ‰§è¡Œé¡ºåºè§£å†³ï¼ˆæˆ‘æ²¡æœ‰åœ¨artitalké¡µé¢è¯„è®ºçš„éœ€æ±‚ï¼Œå› æ­¤æ²¡æœ‰å°è¯•ï¼‰ï¼Œé—®é¢˜2åˆ™éœ€è¦åƒä¸Šé¢æçš„ä¸€æ ·ï¼š**å…±ç”¨AVå¯¹è±¡**ã€‚

è¯´èµ·æ¥å¾ˆé«˜å¤§ä¸Šï¼Œå…¶å®è¯´ç™½äº†å°±æ˜¯è®©è¿™ä¸¤ä¸ªåº”ç”¨ä½¿ç”¨åŒä¸€ä¸ªLeanCloudåº”ç”¨ã€‚

æŒ‰ç…§artitalkå®˜æ–¹æ–‡æ¡£çš„è¯´æ³•ï¼š

> å› ä¸º LeanCloud åŠŸèƒ½çš„é™åˆ¶ã€‚è‹¥æƒ³åŒæ—¶ä½¿ç”¨ valine å’Œ artitalkï¼Œè¯·åœ¨ `class` ä¸­æ·»åŠ åä¸º `Comment` çš„ classã€‚ä¸æ¨èåœ¨å­˜å‚¨ valine çš„åº”ç”¨ä¸­æ–°å»ºåä¸º `shuoshuo` çš„ classï¼Œå¯èƒ½ä¼šå‡ºç°ç¥å¥‡çš„ bugã€‚

æ‰€ä»¥æœ€ç»ˆçš„è§£å†³æ–¹æ³•æ˜¯ï¼š

1. åœ¨artitalkä½¿ç”¨çš„LeanCloudåº”ç”¨ä¸­æ–°å»º`Comment` classï¼Œå¦‚æœæœ‰ä½¿ç”¨è®¿é—®é‡åŠŸèƒ½çš„è¯è¿˜éœ€è¦æ–°å»º`Counter `class

2. å°†åŸæ¥valineåº”ç”¨ä¸­çš„`Comment`å’Œ`Counter` classå¯¼å‡ºï¼ˆ*åæ§½ä¸€å¥ï¼šä¸ºä»€ä¹ˆåªèƒ½åœ¨ä¸­åˆåäºŒç‚¹å‰å¯¼å‡ºå•Šï¼ç»´æŠ¤ç”¨å¾—ç€æ•´æ•´åŠå¤©å—ï¼Ÿï¼*ï¼‰

   ![image-20200827151353004](https://allwens-work.oss-cn-beijing.aliyuncs.com/bed/image-20200827151353004.png)

3. å°†å¯¼å‡ºçš„`Comment`å’Œ`Counter `classå¯¼å…¥åˆ°artitalkä½¿ç”¨çš„åº”ç”¨ä¸­

   ![image-20200827151808051](https://allwens-work.oss-cn-beijing.aliyuncs.com/bed/image-20200827151808051.png)

4. å°†valineä½¿ç”¨çš„IDå’ŒKeyæ”¹æˆå’Œartitalkç›¸åŒçš„ã€‚

åˆ°è¿™ä¸€æ­¥ï¼Œartitalkåº”è¯¥å°±å¯ä»¥å®Œç¾å’Œvalineå…±ç”¨ï¼Œå¹¶å…¼å®¹pjaxå•¦ï¼

## artitalkç¾åŒ–ï¼ˆè‡ªå®šä¹‰æ ·å¼ï¼‰

[è¿™ç¯‡æ–‡ç« ](https://blog.csdn.net/cungudafa/article/details/106224223)ç»™å‡ºäº†å¤šä¸ªè‡ªå®šä¹‰æ ·å¼ï¼Œä½†å®é™…ä½¿ç”¨ä¸­ä¼šå‘ç°æ–‡ä¸­çš„è‡ªå®šä¹‰æ–¹æ³•ä¸èƒ½ç”Ÿæ•ˆã€‚

æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹artitalkæ·»åŠ çš„é»˜è®¤æ ·å¼ï¼š

```css
#artitalk_main .cbp_tmtimeline>li:nth-child(odd) .cbp_tmlabel {
    ......
}
```

å†æ¥çœ‹çœ‹è‡ªå®šä¹‰çš„æ ·å¼ï¼š

```css
.cbp_tmtimeline>li:nth-child(odd) .cbp_tmlabel {
    ......
}
```

æ ¹æ®`css`ä¼˜å…ˆçº§çš„è§„åˆ™ï¼š

> å†…è” > IDé€‰æ‹©å™¨ > ç±»é€‰æ‹©å™¨ > æ ‡ç­¾é€‰æ‹©å™¨ã€‚

åœ¨å…¶ä»–éƒ¨åˆ†ç›¸åŒçš„æƒ…å†µä¸‹ï¼Œartitalkçš„é»˜è®¤æ ·å¼å¤šä½¿ç”¨äº†ä¸€ä¸ªIDé€‰æ‹©å™¨ï¼Œåœ¨ä¼˜å…ˆçº§ä¸Šæ˜¯é«˜äºæˆ‘ä»¬çš„è‡ªå®šä¹‰æ ·å¼çš„ï¼Œå› æ­¤æˆ‘ä»¬çš„è‡ªå®šä¹‰æ ·å¼æ— æ³•æˆåŠŸåº”ç”¨ã€‚

è§£å†³æ–¹æ³•æœ‰ä¸‰ç§ï¼š

1. ä¸ºè‡ªå®šä¹‰æ ·å¼åŒæ ·åŠ ä¸ŠIDé€‰æ‹©å™¨ï¼Œå¹¶ä¿è¯è‡ªå®šä¹‰æ ·å¼ä½äºé»˜è®¤æ ·å¼åã€‚

   > å½“ä¼˜å…ˆçº§ä¸å¤šä¸ª CSS å£°æ˜ä¸­ä»»æ„ä¸€ä¸ªå£°æ˜çš„ä¼˜å…ˆçº§ç›¸ç­‰çš„æ—¶å€™ï¼ŒCSS ä¸­æœ€åçš„é‚£ä¸ªå£°æ˜å°†ä¼šè¢«åº”ç”¨åˆ°å…ƒç´ ä¸Šã€‚

2. ä¸ºè‡ªå®šä¹‰æ ·å¼ä¸­çš„æ¯ä¸ªå±æ€§åŠ ä¸Š`!important`ã€‚

   > å½“åœ¨ä¸€ä¸ªæ ·å¼å£°æ˜ä¸­ä½¿ç”¨ä¸€ä¸ª `!important` è§„åˆ™æ—¶ï¼Œæ­¤å£°æ˜å°†è¦†ç›–ä»»ä½•å…¶ä»–å£°æ˜ã€‚

3. æŒ‡å®š`cssurl`é¡¹

   æ ¹æ®[artitalké…ç½®é¡¹æ–‡æ¡£]([https://artitalk.js.org/settings.html#%F0%9F%93%8Ccssurl](https://artitalk.js.org/settings.html#ğŸ“Œcssurl))ï¼Œå½“æˆ‘ä»¬æŒ‡å®š`cssurl`é¡¹æ—¶ï¼Œé»˜è®¤æ ·å¼å°†ä¸ä¼šè¢«åŠ è½½ï¼Œè½¬è€Œä½¿ç”¨ä½äº`cssurl`çš„cssæ–‡ä»¶ã€‚

   æˆ‘ä»¬å¯ä»¥å°†ä»“åº“ä¸­çš„`main.css`æ‹·è´å‡ºæ¥ï¼ŒæŠŠæŒ‡å®šçš„æ¡ç›®æ¢æˆæˆ‘ä»¬çš„è‡ªå®šä¹‰æ ·å¼ï¼Œå¹¶å°†ä¿®æ”¹åçš„cssæ–‡ä»¶ä¸Šä¼ åˆ°æŸä¸ªç½‘ç«™ï¼Œæœ€åæŠŠä¸Šä¼ åå¾—åˆ°çš„ç›´é“¾åœ°å€å¡«åˆ°`cssurl`é¡¹å³å¯ã€‚

æˆ‘ä¸ªäººä½¿ç”¨çš„æ˜¯ç¬¬ä¸‰ç§æ–¹æ³•ï¼Œå°†ä¿®æ”¹åçš„æ ·å¼ä¸Šä¼ åˆ°è‡ªå·±çš„é˜¿é‡Œäº‘osså¹¶å¼•ç”¨ï¼š

```ejs
<script>
    if (window.AV != undefined) { delete window.AV; }
    var appID = "<%=  theme.plugins.Artitalk.appID  %>";
    var appKEY = "<%=  theme.plugins.Artitalk.appKEY  %>";
    ï¼ˆä¸­é—´çœç•¥ï¼‰
    var cssurl = "https://allwens-work.oss-cn-beijing.aliyuncs.com/bed/artitalk.min.css"
</script>
```

æœ€ç»ˆæ•ˆæœå¯å³é”®æˆ‘çš„åšå®¢ç‚¹å‡»`æˆ‘çš„å°çª`æŸ¥çœ‹ã€‚